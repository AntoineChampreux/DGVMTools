#!/usr/bin/Rscript

######################################
###
###         ©©©©©©©©©©©©©
###       ©©©©©©©©©©©©©©©©©
###      ©©©             ©©©
###     ©©©   ©©©©©©©©    ©©©
###    ©©©   ©©       ©©   ©©©
###   ©©©   ©©         ©©   ©©©
###   ©©©               ©©  ©©©
###   ©©©               ©©  ©©©
###   ©©©               ©©  ©©©
###   ©©©   ©©         ©©   ©©©
###    ©©©   ©©       ©©   ©©©
###     ©©©    ©©©©©©©    ©©© 
###      ©©©             ©©©   
###       ©©©©©©©©©©©©©©©©© 
###         ©©©©©©©©©©©©©  
###
###  COPYLEFT:  ALL RIGHTS REVERSED
###
#####################################



#' Function to get an LPJ-GUESS quantity based on a string
#' 
#' NEED to generalise this to deal with other lists of \code{VegQuants}, not just assuming all are LPJ-GUESS
#' 
#' @param quant.str String holding the id of the \code{VegQuant} you want
#' @param verbose Logical, whether or not to announce which \code{VegQuant} has been found
lookupVegQuantity <- function(quant.str, verbose = FALSE){
  
  # check if the quantity we are storing here is already in the list of pre-defined quantities (LAI, Cmass etc)
  # if not use the 'generic' quantity
  this.quantity <- lpj.quantities[[quant.str]]
  
  if(length(this.quantity) != 0) {
    if(verbose) message(paste("Found quantity ", this.quantity@id, sep = ""))
  }   
  else{
    warning(paste("Didn't find a defined VegQuant for", tolower(quant.str), "using generic values for colors, units etc.", sep = " "))
    this.quantity <- lpj.quantities[["generic"]]
  } 
  
  return(this.quantity)
  
}



#' Global scope list of all LPJ-GUESS (and SPITFIRE) quantities defined as \code{VegQuant} object 
#' from the default LPJ-GUESS model config and a few extra.
#'
#' These quantities have sensible colour schemes, long names and cut ranges for standard global runs,
#' but they will likely need to be modified and new ones aded for a specific analysis.
#' Once the package is loaded this is just a standard R list so can be modified and extended as you wish.
#' 
#' @format A list of \code{VegQuant} objects that store meta-data for output variable commonly used from LPJ-GUESS (and LPJ-GUESS-SPITFIRE)
#' @author Matthew Forrest \email{matthew.forrest@@senckenberg.de}
#' @seealso \code{VegQuant}-class
lpj.quantities <- list(
  
  "fraction" = new("VegQuant",
                   id = "fraction",
                   type = "unknown",
                   short.string = "Fraction",
                   full.string = "Fraction",
                   units = "",
                   colours = colorRampPalette(c("grey85", "black")), 
                   cuts = seq(0,1,0.05)), 
  
  "generic" = new("VegQuant",
                  id = "generic",
                  short.string = "GenVar",
                  full.string = "Generic Variable",
                  type = "unknown",
                  units = "",
                  colours = tim.colors,
                  cuts = integer(0)),
  
  "lai"= new("VegQuant",
             id = "lai",
             short.string = "LAI",
             full.string = "LAI",
             type = "PFT",
             units = "m^2/m^2",
             colours = lai.palette,
             cuts = seq(0,7, 0.01)),
  
  "mlai"=  new("VegQuant",
               id = "mlai",
               short.string = "mLAI",
               full.string = "Monthly LAI",
               type = "monthly",
               units = "m^2/m^2",
               colours = lai.palette,
               cuts = seq(0,10, 0.2)),
  
  "fpc" = new("VegQuant",
              id = "fpc",
              short.string = "FPC",
              full.string = "Foliar Projective Cover",
              type = "PFT",
              units = "m^2/m^2",
              colours = veg.palette,
              cuts = seq(0,1.5, 0.02)),     
  
  "mfpc" = new("VegQuant",
               id = "mfpc",
               short.string = "mFPC",
               full.string = "Monthly Foliar Projective Cover",
               type = "Monthly",
               units = "m^2/m^2",
               colours = veg.palette,
               cuts = seq(0,1.5, 0.02)),
  
  "vegcover"= new("VegQuant",
                  id = "vegcover",
                  short.string = "vegcover",
                  full.string = "Vegetation Cover",
                  type = "",
                  units = "m^2/m^2",
                  colours = veg.palette,
                  cuts = seq(0,1.0, 0.02)),
  
  "agpp" =  new("VegQuant",
                id = "agpp",
                short.string = "aGPP",
                full.string = "Annual GPP",
                type = "PFT",
                units = "kgC/m2/year",
                colours = tim.colors,
                cuts = seq(0, 3, 0.05)),
  
  "cmass"= new("VegQuant",
               id = "cmass",
               short.string = "CMass",
               full.string = "Vegetation Carbon Mass",
               type = "PFT",
               units = "kgC/m^2",
               colours = cmass.palette,
               cuts = seq(0,40,1)),
  
  "agb" = new("VegQuant",
              id = "agb",
              short.string = "ABG",
              full.string = "Above Ground Biomass",
              type = "PFT",
              units = "tonnes/hectare",
              colours = cmass.palette,
              cuts = seq(0,800,10)),
  
  "cpool" =  new("VegQuant",
                 id = "cpool",
                 short.string = "CPool",
                 full.string = "Carbon Pool",
                 type = "pools",
                 units = "kgC/m^2",
                 colours = tim.colors,
                 cuts = seq(0,70,1)),
  
  "litter_wood"= new("VegQuant",
                     id = "litter_wood",
                     short.string = "WoodLitter",
                     full.string = "Wood Litter",
                     type = "PFT",
                     units = "kgC/m^2",
                     colours = tim.colors,
                     cuts = seq(0,2,0.1)),
  
  "litter_leaf" =  new("VegQuant",
                       id = "litter_leaf",
                       short.string = "LeafLitter",
                       full.string = "Leaf Litter",
                       type = "PFT",
                       units = "kgC/m^2",
                       colours = tim.colors,
                       cuts = seq(0,1,0.002)),
  
  "litter_repr"=  new("VegQuant",
                      id = "litter_repr",
                      short.string = "ReproductiveLitter",
                      full.string = "Reproductive Litter",
                      type = "PFT",
                      units = "kgC/m^2",
                      colours = tim.colors,
                      cuts = seq(0,1,0.05)),
  
  "fine_fuel" = new("VegQuant",
                    id = "fine_fuel",
                    short.string = "FineFuel",
                    full.string = "Fine Fuel",
                    type = "PFT",
                    units = "kgC/m^2",
                    colours = tim.colors,
                    cuts = seq(0,1,0.05)),
  
  "mnpp" =  new("VegQuant",
                id = "mnpp",
                short.string = "mNPP",
                full.string = "Month NPP",
                type = "monthly",
                units = "kgC/m^2",
                colours = tim.colors,
                cuts = seq(-0.1, 0.3, 0.01)),
  
  "mgpp" = new("VegQuant",
               id = "mgpp",
               short.string = "mGPP",
               full.string = "Monthly GPP", 
               type = "monthly",
               units = "kgC/m^2",
               colours = tim.colors,
               cuts = seq(0, 0.4, 0.01)),
  
  "mnee" = new("VegQuant",
               id = "mnee",
               short.string = "mNEE",
               full.string = "Monthly NEE", 
               type = "monthly",
               units = "kgC/m^2",
               colours = tim.colors,
               cuts = seq(-0.1, 0.2, 0.01)),
  
  "mrh" =new("VegQuant",
             id = "mrh",
             short.string = "mRh",
             full.string = "Monthly Heterotrophic Respiration", 
             type = "monthly",
             units = "kgC/m^2",
             colours = tim.colors,
             cuts = seq(0.0, 0.3, 0.005)),
  
  "mra" =  new("VegQuant",
               id = "mra",
               short.string = "mRa",
               full.string = "Monthly Autotrophic Respiration", 
               type = "monthly",
               units = "kgC/m^2",
               colours = tim.colors,
               cuts = seq(0.0, 0.3, 0.005)),
  
  "anpp" = new("VegQuant",
               id = "anpp",
               short.string = "aNPP",
               full.string = "Annual NPP", 
               type = "PFT",
               units = "kgC/m^2",
               colours = tim.colors,
               cuts = seq(-0.5, 2, 0.1)),
  
  "cflux" = new("VegQuant",
                id = "cflux",
                short.string = "CFlux",
                full.string = "Carbon Flux", 
                type = "flux",
                units = "kgC/m^2/y",
                colours = tim.colors,
                cuts = seq(-3, 3, 0.1)),
  
  "dens" = new("VegQuant",
               id = "dens",
               short.string = "Dens",
               full.string = "PFT Density", 
               type = "PFT",
               units = "indiv/m^2",
               colours = tim.colors,
               cuts = seq(0, 0.1, 0.002)),
  
  "speciesheights"= new("VegQuant",
                        id = "speciesheights",
                        short.string = "SpeciesHeights",
                        full.string = "PFT Average Heights", 
                        type = "PFT",
                        units = "m",
                        colours = tim.colors,
                        cuts = seq(0, 40, 1)),
  
  "maet"  = new("VegQuant",
                id = "maet",
                short.string = "mAET",
                full.string = "Monthly Actual Evapotranspiration", 
                type = "monthly",
                units = "mm/month",
                colours = tim.colors,
                cuts = seq(0, 200, 10)),
  
  "mpet" = new("VegQuant",
               id = "mpet",
               short.string = "mPET",
               full.string = "Monthly Potential Evapotranspiration", 
               type = "monthly",
               units = "mm/month",
               colours = tim.colors,
               cuts = seq(0, 300, 10)),
  
  "mevap" = new("VegQuant",
                id = "mevap",
                short.string = "mEvap",
                full.string = "Monthly Evaporation", 
                type = "monthly",
                units = "mm/month",
                colours = tim.colors,
                cuts = seq(0, 100, 2)),
  
  "mrunoff" = new("VegQuant",
                  id = "mrunoff",
                  short.string = "mRunoff",
                  full.string = "Monthly Runoff", 
                  type = "monthly",
                  units = "mm/month",
                  colours = tim.colors,
                  cuts = seq(0, 500, 10)),
  
  "mintercep" = new("VegQuant",
                    id = "mintercep",
                    short.string = "mIntercep",
                    full.string = "Monthly Interception", 
                    type = "monthly",
                    units = "mm/month",
                    colours = tim.colors,
                    cuts = seq(0, 50, 1)),
  
  "mwcont_upper" =  new("VegQuant",
                        id = "mwcont_upper",
                        short.string = "mWC_upper",
                        full.string = "Monthly Upper Soil Layer WC", 
                        type = "monthly",
                        units = "",
                        colours = rev.tim.colors,
                        cuts = seq(0, 1, 0.02)),
  
  "mwcont_lower" =  new("VegQuant",
                        id = "mwcont_lower",
                        short.string = "mWC_lower",
                        full.string = "Monthly Lower Soil Layer", 
                        type = "monthly",
                        units = "",
                        colours = rev.tim.colors,
                        cuts = seq(0, 1, 0.02)),
  
  "msnowpack" = new("VegQuant",
                    id = "msnowpack",
                    short.string = "mSnowPack",
                    full.string = "Monthly Snow Pack", 
                    type = "monthly",
                    units = "mm H20",
                    colours = rev.tim.colors,
                    cuts = seq(0, 5, 0.02)), 
  
  "firert" = new("VegQuant",
                 id = "firert",
                 short.string = "FireRT",
                 full.string = "Fire Return Interval", 
                 type = "annual",
                 units = "years",
                 colours = fire.palette,
                 cuts = c(0,3,6,12,25,50,100,200,400,800,1000)),
  
  "fireseason" = new("VegQuant",
                     id = "fireseason",
                     short.string = "FireSL",
                     full.string = "Fire Season Length", 
                     type = "annual",
                     units = "days",
                     colours = fire.palette,
                     cuts = seq(0, 365, 5)),
  
  "firesl" = new("VegQuant",
                 id = "firesl",
                 short.string = "FireSL",
                 full.string = "Fire Season Length", 
                 type = "annual",
                 units = "days",
                 colours = fire.palette,
                 cuts = seq(0, 365, 5)), 
  
  "burntarea" = new("VegQuant",
                    id = "burntarea",
                    short.string = "BAFrac",
                    full.string = "Annual Fraction Burned", 
                    type = "annual",
                    units = "fraction of gridcell",
                    colours = fire.palette,
                    cuts = seq(0, 1.0, 0.01)),
  
  "tot_runoff" = new("VegQuant",
                     id = "tot_runoff",
                     short.string = "Tot_Runoff",
                     full.string = "Annual Total Runoff", 
                     type = "annual",
                     units = "mm/year",
                     colours = tim.colors,
                     cuts = seq(0, 1000, 50)), 
  
  "bioclim" = new("VegQuant",
                  id = "bioclim",
                  short.string = "BiomClim",
                  full.string = "Bioclimatic Limit Variables",
                  type = "irregular",
                  units = "kgC/m^2",
                  colours = tim.colors,
                  cuts = seq(-1, 3, 0.1)),
  
  "gdd5" = new("VegQuant",
               id = "gdd5",
               short.string = "GDD5",
               full.string = "Growing Degree Days (5deg C base)",
               type = "annual",
               units = "degree days",
               colours = tim.colors,
               cuts = seq(0, 5000, 100)),
  
  
  #############################################################################################
  ############################# SPITFIRE QUANTITES ############################################
  #############################################################################################
  
  "mfirefrac" = new("VegQuant",
                    id = "mfirefrac",
                    short.string = "mFireFrac",
                    full.string = "Monthly Burned Area Fraction", 
                    type = "monthly",
                    units = "",
                    colours = tim.colors,
                    cuts = seq(0,1,0.05)),
  
  "mtau_l" =  new("VegQuant",
                  id = "mtau_l",
                  short.string = "mTau_l",
                  full.string = "Monthly Residence Time", 
                  type = "monthly",
                  units = "mins",
                  colours = tim.colors,
                  cuts = seq(0,8,0.2)),
  
  "pyro_flux" = new("VegQuant",
                    id = "pyro_flux",
                    short.string = "PyroFlux",
                    full.string = "Pyrogenic Emmisions", 
                    type = "irregular",
                    units = "kg species/m^2",
                    colours = tim.colors),
  
  "mfireintens" = new("VegQuant",
                      id = "mfireintens",
                      short.string = "mFireIntensity",
                      full.string = "Monthly Fire Intensity", 
                      type = "monthly",
                      units = "kW/m^2",
                      colours = tim.colors,
                      cuts = seq(0, 5000, 50)),
  
  "mlivegrass_fuel" = new("VegQuant",
                          id = "mlivegrass_fuel",
                          short.string = "mlivegrass_Fuel",
                          full.string = "Mean Monthly Live Grass Fuel", 
                          type = "monthly",
                          units = "kgC/m^2",
                          colours = tim.colors,
                          cuts = seq(0,1,0.01)),
  
  "m1hr_fuel" = new("VegQuant",
                    id = "m1hr_fuel",
                    short.string = "m1hr_Fuel",
                    full.string = "Mean Monthly 1hr Fuel", 
                    type = "monthly",
                    units = "kgC/m^2",
                    colours = tim.colors,
                    cuts = seq(0,1,0.01)),
  
  "m10hr_fuel" = new("VegQuant",
                     id = "m10hr_fuel",
                     short.string = "m10hr_Fuel",
                     full.string = "Mean Monthly 10hr Fuel", 
                     type = "monthly",
                     units = "kgC/m^2",
                     colours = tim.colors,
                     cuts = seq(0,1,0.01)),
  
  "m100hr_fuel" = new("VegQuant",
                      id = "m100hr_fuel",
                      short.string = "m100hr_Fuel",
                      full.string = "Mean Monthly 100hr Fuel", 
                      type = "monthly",
                      units = "kgC/m^2",
                      colours = tim.colors,
                      cuts = seq(0,1,0.01)),
  
  "m1000hr_fuel" = new("VegQuant",
                       id = "m1000hr_fuel",
                       short.string = "m1000hr_Fuel",
                       full.string = "Mean Monthly 1000hr Fuel", 
                       type = "monthly",
                       units = "kgC/m^2",
                       colours = tim.colors,
                       cuts = seq(0,1,0.01)),
  
  "mlivegrass_cc" = new("VegQuant",
                        id = "mlivegrass_cc",
                        short.string = "mlivegrass_cc",
                        full.string = "Mean Monthly Live Grass Combustion Completeness", 
                        type = "monthly",
                        units = "kgC/m^2",
                        colours = tim.colors,
                        cuts = seq(0,1,0.01)),     
  
  "m1hr_cc"= new("VegQuant",
                 id = "m1hr_cc",
                 short.string = "m1hr_cc",
                 full.string = "Mean Monthly 1hr Combustion Completeness", 
                 type = "monthly",
                 units = "kgC/m^2",
                 colours = tim.colors,
                 cuts = seq(0,1,0.01)),
  
  "m10hr_cc" = new("VegQuant",
                   id = "m10hr_cc",
                   short.string = "m19hr_cc",
                   full.string = "Mean Monthly 10hr Combustion Completeness", 
                   type = "monthly",
                   units = "kgC/m^2",
                   colours = tim.colors,
                   cuts = seq(0,1,0.01)),
  
  "m100hr_cc" = new("VegQuant",
                    id ="m100hr_cc",
                    short.string = "m100hr_cc",
                    full.string = "Mean Monthly 100hr Combustion Completeness", 
                    type = "monthly",
                    units = "kgC/m^2",
                    colours = tim.colors,
                    cuts = seq(0,1,0.01)),
  
  "m1000hr_cc" = new("VegQuant",
                     id = "m1000hr_cc",
                     short.string = "m1000hr_cc",
                     full.string = "Mean Monthly 1000hr Combustion Completeness", 
                     type = "monthly",
                     units = "kgC/m^2",
                     colours = tim.colors,
                     cuts = seq(0,1,0.01)),
  
  "afdays" = new("VegQuant",
                 id = "afdays",
                 short.string = "aFireDays",
                 full.string = "Fire Days per Year", 
                 type = "annual",
                 units = "days",
                 colours = tim.colors,
                 cuts = seq(0, 366, 12)),
  
  "mavenest" = new("VegQuant",
                   id = "mavenest",
                   short.string = "mNesterov",
                   full.string = "Average Monthly Nesterov", 
                   type = "monthly",
                   units = "",
                   colours = tim.colors,
                   cuts = seq(0, 100000, 5000)),
  
  "mdlm_livegrass" = new("VegQuant",
                         id = "mdlm_livegrass",
                         short.string = "mDLM_livegrass",
                         full.string = "Monthly Litter Moisture of Live Grass", 
                         type = "monthly",
                         units = "",
                         colours = tim.colors,
                         cuts = seq(0, 1, 0.02)),
  
  "mdlm_deadfuel" = new("VegQuant",
                        id = "mdlm_deadfuel",
                        short.string = "mDLM_deadfuel",
                        full.string = "Monthly Litter Moisture of Dead Fuel", 
                        type = "monthly",
                        units = "",
                        colours = tim.colors,
                        cuts = seq(0, 1, 0.02)),
  
  "meff_wind" = new("VegQuant",
                    id = "meff_wind",
                    short.string = "mEffWind",
                    full.string = "Monthly Effective Windspeed", 
                    type = "monthly",
                    units = "m/min",
                    colours = tim.colors,
                    cuts = seq(0, 100, 0.2)),
  
  "mnfdi" = new("VegQuant",
                id = "mnfdi",
                short.string = "mNFDI",
                full.string = "Monthly Nesterov Fire Danger Index", 
                type = "monthly",
                units = "m/min",
                colours = tim.colors,
                cuts = seq(0, 1, 0.02)),
  
  "mFBD" = new("VegQuant",
               id = "mFBD",
               short.string = "mFBD",
               full.string = "Monthly Fuel Bulk Density", 
               type = "monthly",
               units = "m^3/m^3",
               colours = tim.colors,
               cuts = seq(0, 30, 1)),
  
  "mSAV" = new("VegQuant",
               id = "mSAV",
               short.string = "mSAV",
               full.string = "Monthly Surface Area to Volume Ratio", 
               type = "monthly",
               units = "m^2/m^3",
               colours = tim.colors,
               cuts = seq(25, 100, 5)),
  
  "mMoE" = new("VegQuant",
               id = "mMoE",
               short.string = "mMOE",
               full.string = "Monthly Moisture of Extinction", 
               type = "monthly",
               units = "",
               colours = tim.colors,
               cuts = seq(0.2, 0.4, 0.01)),
  
  "mmcont" = new("VegQuant",
                 id = "mmcont",
                 short.string = "mFMCont",
                 full.string = "Monthly Fuel Moisture Content", 
                 type = "monthly",
                 units = "",
                 colours = tim.colors,
                 cuts = seq(0, 1, 0.05)),
  
  "mfire_durat" = new("VegQuant",
                      id = "mfire_durat",
                      short.string = "mFire_Duration",
                      full.string = "Monthly Fire Duration", 
                      type = "monthly",
                      units = "mins",
                      colours = tim.colors,
                      cuts = seq(0, 250, 5)),
  
  "mscorch_height" = new("VegQuant",
                         id = "mscorch_height",
                         short.string = "mScorch_Height",
                         full.string = "Monthly Scorch Height", 
                         type = "monthly",
                         units = "m",
                         colours = tim.colors,
                         cuts = seq(0, 30, 1)),
  
  "mros" = new("VegQuant",
               id = "mros",
               short.string = "mROS",
               full.string = "Monthly Rate of Spread", 
               type = "monthly",
               units = "m/min",
               colours = tim.colors,
               cuts = seq(0, 30, 1)),
  
  "mfire_size" = new("VegQuant",
                     id = "mfire_size",
                     short.string = "mfire_size",
                     full.string = "Monthly Fire Size", 
                     type = "monthly",
                     units = "ha",
                     colours = tim.colors,
                     cuts = seq(0, 100, 1)),
  
  "mhuman_ign" = new("VegQuant",
                     id = "mhuman_ign",
                     short.string = "mhuman_ign",
                     full.string = "Monthly average of human ignition rate", 
                     type = "monthly",
                     units = "ign/day",
                     colours = tim.colors,
                     cuts = seq(0, 100, 1)),
  
  "mlightning_ign" = new("VegQuant",
                         id = "mlightning_ign",
                         short.string = "mlightning_ign",
                         full.string = "Monthly average of lightning ignition rate", 
                         type = "monthly",
                         units = "ign/day",
                         colours = tim.colors,
                         cuts = seq(0, 5, 0.1)),
  
  "mfireday_duration" = new("VegQuant",
                            id = "mfireday_duration",
                            short.string = "mFire_Duration_FireDays",
                            full.string = "Monthly Fire Duration (Fire Days Only)", 
                            type = "monthly",
                            units = "mins",
                            colours = tim.colors,
                            cuts = seq(0, 250, 5)),
  
  "mfireday_scorch_height" = new("VegQuant",
                                 id = "mfireday_scorch_height",
                                 short.string = "mScotch_Height_FireDays",
                                 full.string = "Monthly Scorch Height (Fire Days Only)", 
                                 type = "monthly",
                                 units = "m",
                                 colours = tim.colors,
                                 cuts = seq(0, 30, 1)),
  
  "mfireday_intensity" = new("VegQuant",
                             id = "mfireday_intensity",
                             short.string = "mFire_Intensity_FireDays",
                             full.string = "Monthly Fire Intensity (Fire Days Only)", 
                             type = "monthly",
                             units = "kW/m",
                             colours = tim.colors,
                             cuts = seq(0, 500000, 5000)),
  
  "mfireday_nesterov" =  new("VegQuant",
                             id = "mfireday_nesterov",
                             short.string = "mNesterov_FireDays",
                             full.string = "Monthly Nesterov (Fire Days Only)", 
                             type = "monthly",
                             units = "",
                             colours = tim.colors,
                             cuts = seq(0, 5000000, 5000)),
  
  "mfireday_residence_time" = new("VegQuant",
                                  id = "mfireday_residence_time",
                                  short.string = "mResidence_Time_FireDays",
                                  full.string = "Monthly Residence Time (Fire Days Only)", 
                                  type = "monthly",
                                  units = "min",
                                  colours = tim.colors,
                                  cuts = seq(0, 10, 0.1)),
  
  "allocation_fails" = new("VegQuant",
                           id = "allocation_fails",
                           short.string = "mAllocationFails",
                           full.string = "Monthly Allocation Fails", 
                           type = "annual",
                           units = "days",
                           colours = tim.colors,
                           cuts = seq(0,31,1)),
  
  "allocation_iters" = new("VegQuant",
                           id = "allocation_iters",
                           short.string = "mAllocationIters",
                           full.string = "Monthly Iteration To Allocation Fire", 
                           type = "annual",
                           units = "days",
                           colours = tim.colors,
                           cuts = seq(0,20,1))
)




