#!/usr/bin/Rscript

######################################
###
###         ©©©©©©©©©©©©©
###       ©©©©©©©©©©©©©©©©©
###      ©©©             ©©©
###     ©©©   ©©©©©©©©    ©©©
###    ©©©   ©©       ©©   ©©©
###   ©©©   ©©         ©©   ©©©
###   ©©©               ©©  ©©©
###   ©©©               ©©  ©©©
###   ©©©               ©©  ©©©
###   ©©©   ©©         ©©   ©©©
###    ©©©   ©©       ©©   ©©©
###     ©©©    ©©©©©©©    ©©© 
###      ©©©             ©©©   
###       ©©©©©©©©©©©©©©©©© 
###         ©©©©©©©©©©©©©  
###
###  COPYLEFT:  ALL RIGHTS REVERSED
###
###################################### 

######################################


###########################################################################
###
### RCVTool - lpj-tools package
###
### This is a 'meta-package' bringing together a collection 
### of plotting tools and classes for either standard output
### from LPJ-GUESS or from files already averaged over the target period
###
### Author: Matthew Forrest 
### Date: 04/09/2013
### Version: v2.5 - still under development
###
### * Takes a flexible number of text files ('runs') of LAI/FPC/Biomass etc
### and plots the variable by PFT, total tree, grass and shrub LAI and dominant PFT by LAI.
### * When getting dominant PFT it combines shade-tolerant and shade-intolerant
### PFTs.
### * Can deal with different runs having different PFTs.
### * Has a reasonably nice colour scheme for standard PFTs.
### * Heavily utilises the 'sp' package for much of the heavy lifting and classes
###
###########################################################################


####### INCLUDE SOME NECESSARY LIBRARIES #####################
# these should all be available from CRAN with no problems
library(sp)
library(raster)
library(rgdal)
library(lattice)
library(fields) # for tim.colors
library(data.table)
library(xts)
library(foreach)
library(doParallel)
library(rgeos)  # only used for cropping Spatial Lines at the moment, can easily be hacked out if required
library(compiler)

####### SPECIFY BASE DIRECTORY OF PACKAGE HERE ##############
base.dir <- "~/Tools/RVCTools/v2.8"

####### SPECIFY LOCATION OF SHAPEFILES HERE #################
### NOTE: Must be full path for OGR or it gets confused :-(
shapefile.dir <- "/home/forrest/AuxiliaryData/Shapefiles"

####### SPECIFY LOCATION OF BENCHMARKING DATA HERE ##########
benchmarking.data.dir <- "/data/forrest/BenchmarkingData/"

####### FILENAMES FOR ALL THE BENCHMARKING DATA
saatchi2011.file <- file.path(benchmarking.data.dir, "Saatchi2011/LPJ_Mean_Saatchi_carbon_from_1km_kgC_per_sqm.txt")
baccini2012.file <-  file.path(benchmarking.data.dir, "Baccini2012/Baccini_220912.txt")
gc2009.natural.file <-  file.path(benchmarking.data.dir, "Globcover2009/naturalFraction.Globcover2009.nc")
gc2005.natural.file <-  file.path(benchmarking.data.dir, "Globcover2005/naturalFraction.Globcover2005.nc")
globalbiome.file <-  file.path(benchmarking.data.dir, "GlobalBiomes/vegmap18_fromTH_Hickler2006.out")
gfed4.annual <-  file.path(benchmarking.data.dir, "GFED4/GFED4.0_HD_Annual_BA.nc")
modis.treecover.2000_2010 <-  file.path(benchmarking.data.dir, "MODISTreecover/VCF_2000-2010avg.nc")
modis.treecover.each.year <-  file.path(benchmarking.data.dir, "MODISTreecover/VCF_r0.500000_")
lpj.HD.gridlist <- "/home/forrest/AuxiliaryData/Gridlists/gridlist_global_0.5deg.txt"


###############################################################################
### LOAD ALL FUNCTIONS IN THE LIBRARY 
### Normally no need to do anything here
###############################################################################


####### SOURCE ALL THE FILES TO LOAD ALL THE FUNCTIONS AND OBJECTS
source(file.path(base.dir, "rvc-classes.R"))
source(file.path(base.dir, "rvc-misc.R"))
source(file.path(base.dir, "rvc-plotting.R"))


####### SOURCE ALL THE FILES TO LOAD ALL THE FUNCTIONS FOR HANDLING LPJ RUNS
source(file.path(base.dir, "lpj-runtools.R"))
source(file.path(base.dir, "lpj-processingtools.R"))
source(file.path(base.dir, "lpj-plotting.R"))
#source(file.path(base.dir, "lpj-colourschemes.R"))
source(file.path(base.dir, "lpj-quantities.R"))
source(file.path(base.dir, "lpj-globalPFTs.R"))

####### SOURCE ALL THE FILES TO LOAD ALL THE FUNCTIONS FOR HANDLING CLIMATE DATA
source(file.path(base.dir, "clim-tools.R"))


####### SOURCE BENCHMARKS ###################################
source(file.path(base.dir, "datasets", "Saatchi2011.R"))  
source(file.path(base.dir, "datasets", "Baccini2012.R"))      
source(file.path(base.dir, "datasets", "readNaturalLandCoverGC2009.R"))   
source(file.path(base.dir, "datasets", "readNaturalLandCoverGC2005.R"))      
source(file.path(base.dir, "datasets", "readPNVBiomes.R"))
source(file.path(base.dir, "datasets", "GFED4.R"))      
source(file.path(base.dir, "datasets", "MODISTreecover.R"))      



message("+++ Loaded RVCTools +++")
